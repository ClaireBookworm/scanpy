<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Tests &mdash; Scanpy 1.8.2 documentation</title>

<link rel=stylesheet href="https://cdn.jsdelivr.net/npm/docsearch.js@2.6/dist/cdn/docsearch.min.css"/>

      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/scanpy.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../_static/typehints.css" type="text/css" />
      <link rel="stylesheet" href="https://assets.readthedocs.com/css/badge_only.css" type="text/css" />
    <link rel="canonical" href="https://scanpy.readthedocs.io/en/stable/dev/testing.html" />

  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://assets.readthedocs.com/javascript/readthedocs-doc-embed.js"></script>
    <script src="../_static/js/theme.js"></script>

<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2.6/dist/cdn/docsearch.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => docsearch({
    apiKey: 'fa4304eb95d2134997e3729553a674b2',
    indexName: 'scanpy',
    inputSelector: '#rtd-search-form > input[name="q"]',
    algoliaOptions: { facetFilters: ['version:latest'] },
    debug: false,
  }))
</script>


    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Documentation" href="documentation.html" />
    <link rel="prev" title="Getting set up" href="getting-set-up.html" />
 



<!-- RTD Extra Head -->

<link rel="stylesheet" href="https://assets.readthedocs.com/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": false, "api_host": "https://readthedocs.com", "build_date": "2021-11-03T17:53:42Z", "builder": "sphinx", "canonical_url": null, "commit": "8736fc3b", "docroot": "/docs/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-2", "language": "en", "page": "dev/testing", "programming_language": "py", "project": "icb-scanpy", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "scanpydoc", "user_analytics_code": "", "version": "stable"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="https://assets.readthedocs.com/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/Scanpy_Logo_BrightFG.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                stable
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage-principles.html">Usage Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../external.html">External API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ecosystem.html">Ecosystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../news.html">News</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Contributing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="code.html">Contributing code</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-set-up.html">Getting set up</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#running-the-tests">Running the tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#miscellaneous-tips">Miscellaneous tips</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#writing-tests">Writing tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-to-test">What to test</a></li>
<li class="toctree-l4"><a class="reference internal" href="#performance">Performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plotting-tests">Plotting tests</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="external-tools.html">External tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="ci.html">CI</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html">Making a release</a></li>
<li class="toctree-l2"><a class="reference internal" href="versioning.html">Versioning</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Scanpy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Contributing</a> &raquo;</li>
      <li>Tests</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/theislab/scanpy/blob/8736fc3b02a6af3b7214481c2cf78a3f8f5e06bd/docs/dev/testing.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tests">
<span id="id1"></span><h1>Tests<a class="headerlink" href="#tests" title="Permalink to this headline"></a></h1>
<p>Possibly the most important part of contributing to any open source package is the test suite.
Implementations may change, but the only way we can know the code is working before making a release is the test suite.</p>
<section id="running-the-tests">
<h2>Running the tests<a class="headerlink" href="#running-the-tests" title="Permalink to this headline"></a></h2>
<p>We use <a class="reference external" href="https://docs.pytest.org/en/stable/">pytest</a> to test scanpy.
To run the tests first make sure you have the required dependencies (<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">&quot;.[tests]&quot;</span></code>), then run <code class="docutils literal notranslate"><span class="pre">pytest</span></code> from the root of the repository.</p>
<p>It can take a while to run the whole test suite. There are a few ways to cut down on this while working on a PR:</p>
<ol class="arabic simple">
<li><p>Only run a subset of the tests. This can be done with the <code class="docutils literal notranslate"><span class="pre">-k</span></code> argument from pytest (e.g. <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">-k</span> <span class="pre">test_plotting.py</span></code> or <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">-k</span> <span class="pre">&quot;test_umap*&quot;</span></code></p></li>
<li><p>Run the tests in parallel. If you install the pytest extension <a class="reference external" href="https://github.com/pytest-dev/pytest-xdist">pytest-xdist</a> you can run tests in parallel with the <code class="docutils literal notranslate"><span class="pre">--numprocesses</span></code> argument to pytest (e.g. <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">-n</span> <span class="pre">8</span></code>).</p></li>
</ol>
<section id="miscellaneous-tips">
<h3>Miscellaneous tips<a class="headerlink" href="#miscellaneous-tips" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>A lot of warnings can be thrown while running the test suite. It’s often easier to read the test results with them hidden via the <code class="docutils literal notranslate"><span class="pre">--disable-pytest-warnings</span></code> argument.</p></li>
</ul>
</section>
</section>
<section id="writing-tests">
<h2>Writing tests<a class="headerlink" href="#writing-tests" title="Permalink to this headline"></a></h2>
<p>You can refer to the <a class="reference external" href="https://github.com/theislab/scanpy/tree/master/scanpy/tests">existing test suite</a> for examples.
If you haven’t written tests before, Software Carpentry has an <a class="reference external" href="http://katyhuff.github.io/python-testing/">in-depth guide</a> on the topic.</p>
<p>We highly recommend using <a class="reference external" href="https://en.wikipedia.org/wiki/Test-driven_development">Test Driven Development</a> when contributing code.
This not only ensures you have tests written, it often makes implementation easier since you start out with a specification for your function.</p>
<p>Consider parameterizing your tests using the <code class="docutils literal notranslate"><span class="pre">pytest.mark.parameterize</span></code> and <code class="docutils literal notranslate"><span class="pre">pytest.fixture</span></code> decorators.
Documentation on these can be found <a class="reference external" href="https://docs.pytest.org/en/stable/fixture.html">here</a>, but we’d also recommend searching our test suite for existing usage.</p>
<section id="what-to-test">
<h3>What to test<a class="headerlink" href="#what-to-test" title="Permalink to this headline"></a></h3>
<p>If you’re not sure what to tests about your function, some ideas include:</p>
<ul class="simple">
<li><p>Are there arguments which conflict with each other? Check that if they are both passed, the function throws an error (see <code class="docutils literal notranslate"><span class="pre">pytest.raises</span></code> <a class="reference external" href="https://docs.pytest.org/en/stable/assert.html#assertions-about-expected-exceptions">in the pytest docs</a>.</p></li>
<li><p>Are there input values which should cause your function to error?</p></li>
<li><p>Did you add a helpful error message that recommends better outputs? Check that that error message is actually thrown.</p></li>
<li><p>Can you place bounds on the values returned by your function?</p></li>
<li><p>Are there different input values which should generate equivalent output (e.g. if an array is sparse or dense)?</p></li>
<li><p>Do you have arguments which should have orthogonal effects on the output? Check that they are independent. For example, if there is a flag for extended output, the base output should remain the same either way.</p></li>
<li><p>Are you optimizing a method? Check that it’s results are the same as a gold standard implementation.</p></li>
</ul>
</section>
<section id="performance">
<h3>Performance<a class="headerlink" href="#performance" title="Permalink to this headline"></a></h3>
<p>It’s more important that you’re accurately testing the code works than it is that test suite runs quickly.
That said, it’s nice when the test suite runs fast.</p>
<p>You can check how long tests take to run by passing <code class="docutils literal notranslate"><span class="pre">--durations=0</span></code> argument to <code class="docutils literal notranslate"><span class="pre">pytest</span></code>.
Hopefully your new tests won’t show up on top!
Some approaches to this include:</p>
<ul class="simple">
<li><p>Is there a common setup/ computation happening in each test? Consider caching these in a <a class="reference external" href="https://docs.pytest.org/en/stable/fixture.html#sharing-test-data">scoped test fixture</a>.</p></li>
<li><p>Is the behaviour you’re testing for dependent on the size of the data? If not, consider reducing it.</p></li>
</ul>
</section>
<section id="plotting-tests">
<h3>Plotting tests<a class="headerlink" href="#plotting-tests" title="Permalink to this headline"></a></h3>
<p>While computational functions will return arrays and values, it can be harder to work with the output of plotting functions.</p>
<p>To make this easier, we use the <code class="docutils literal notranslate"><span class="pre">image_comparer</span></code> fixture for comparing plotting results (search the test suite for example usage).
This is used to check that generated plots look the same as they did previously.
Reference images (the expected output) are kept <code class="docutils literal notranslate"><span class="pre">scanpy/tests/_images</span></code> and compared with the results of running the test suite by running the tests.</p>
<p>A common gotcha here is that plots often change slightly on different machines/ OSs.
<code class="docutils literal notranslate"><span class="pre">scanpy</span></code>’s test suite sets a number of environment variables to ensure as similar of plots as possible.
When adding new reference plots, the recommended workflow is to write the test as though an expected result already exists, run it once to generate the output, then move that output to the reference directory.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="getting-set-up.html" class="btn btn-neutral float-left" title="Getting set up" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="documentation.html" class="btn btn-neutral float-right" title="Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Alex Wolf, Philipp Angerer, Fidel Ramirez, Isaac Virshup, Sergei Rybakov, Gokcen Eraslan, Tom White, Malte Luecken, Davide Cittaro, Tobias Callies, Marius Lange, Andrés R. Muñoz-Rojas..
      <span class="commit">Revision <code>8736fc3b</code>.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: stable
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="/en/latest/">latest</a></dd>
        
          <dd><a href="/en/stable/">stable</a></dd>
        
          <dd><a href="/en/docsearch/">docsearch</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
      </dl>
      <dl>
        
        <dt>On Read the Docs</dt>
          <dd>
            <a href="//readthedocs.com/projects/icb-scanpy/?fromdocs=icb-scanpy">Project Home</a>
          </dd>
          <dd>
            <a href="//readthedocs.com/builds/icb-scanpy/?fromdocs=icb-scanpy">Builds</a>
          </dd>
      </dl>
    </div>
  </div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>